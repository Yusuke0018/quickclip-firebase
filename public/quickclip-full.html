<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QuickClip Firebase - ã‚¹ãƒãƒ¼ãƒˆå®šå‹æ–‡ç®¡ç†</title>
    
    <!-- Firebase v9 compatibility mode -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ã‚’é˜²ã */
        button, a, input, textarea, select {
            touch-action: manipulation;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        /* Header */
        .header {
            background-color: #fff;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #e5e5e5;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info span {
            color: #6b7280;
            font-size: 0.9375rem;
        }
        
        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            height: fit-content;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 2rem;
        }
        
        .category-list {
            list-style: none;
            margin-top: 1rem;
        }
        
        .category-item {
            padding: 0.75rem;
            margin: 0.25rem 0;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            border: 2px solid transparent;
        }
        
        .category-edit-btn {
            position: absolute;
            right: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .category-item:hover .category-edit-btn {
            opacity: 1;
        }
        
        @media (hover: hover) {
            .category-item:hover {
                background-color: #f0f0f0;
                transform: translateX(4px);
            }
        }
        
        .category-item.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
            font-weight: 500;
        }
        
        .category-icon {
            width: 20px;
            height: 20px;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        /* Main content */
        .main-content {
            background-color: transparent;
            padding: 0;
        }
        
        .snippets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-top: 1.5rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        .snippet-card {
            background-color: #fff;
            padding: 1.25rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            position: relative;
            border: 1px solid #e5e5e5;
            cursor: pointer;
            animation: fadeIn 0.3s ease-out;
        }
        
        @media (max-width: 768px) {
            .snippet-card:active {
                transform: scale(0.98);
                background-color: #e5e5e5;
            }
        }
        
        @media (hover: hover) {
            .snippet-card:hover {
                background-color: #f0f0f0;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
                transform: translateY(-2px);
            }
        }
        
        @media (hover: hover) {
            .snippet-card:hover .snippet-actions {
                opacity: 1;
            }
            
            /* ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚’ç›®ç«‹ãŸã›ã‚‹ */
            .snippet-card:hover .copy-btn {
                background-color: #2563eb;
                color: white;
            }
        }
        
        .snippet-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: #1f2937;
        }
        
        .snippet-content {
            color: #6b7280;
            font-size: 0.9375rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            word-wrap: break-word;
            word-break: break-word;
            white-space: pre-wrap;
            max-width: 100%;
            line-height: 1.6;
        }
        
        .snippet-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        /* ãƒ”ãƒ³ç•™ã‚ãƒœã‚¿ãƒ³ã¯å¸¸ã«éè¡¨ç¤º */
        .snippet-actions .btn-icon:first-child {
            display: none;
        }
        
        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #f3f4f6;
            color: #374151;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #e0e0e0;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.2);
        }
        
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        
        .btn-icon {
            padding: 0.5rem;
            background-color: transparent;
            color: #666;
            min-width: 44px;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-icon:hover {
            background-color: #e5e5e5;
            color: #333;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #666;
        }
        
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.625rem 0.875rem;
            background-color: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            color: #374151;
            font-size: 0.9375rem;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }
        
        /* Utilities */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #9ca3af;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            border: 2px dashed #e5e7eb;
        }
        
        .pin-icon {
            color: #fbbf24;
        }
        
        .success-message {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.375rem;
            animation: slideIn 0.3s ease-out;
            z-index: 1001;
        }
        
        @media (max-width: 768px) {
            .success-message {
                bottom: 50%;
                left: 50%;
                right: auto;
                transform: translate(-50%, 50%);
                font-size: 1.125rem;
                padding: 1.5rem 2rem;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* è¿½åŠ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .spinner {
            border: 2px solid #e5e5e5;
            border-top-color: #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .container {
                grid-template-columns: 1fr;
                padding: 1rem 0.5rem;
                gap: 1rem;
            }
            
            .sidebar {
                display: none;
            }
            
            .sidebar.mobile-active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #fff;
                z-index: 999;
                overflow-y: auto;
                padding: 1rem;
            }
            
            .mobile-menu-btn {
                display: block;
                position: fixed;
                bottom: 1rem;
                right: 1rem;
                width: 64px;
                height: 64px;
                background-color: #2563eb;
                color: white;
                border-radius: 50%;
                border: none;
                font-size: 1.75rem;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 998;
                touch-action: manipulation;
            }
            
            .mobile-menu-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid #e5e5e5;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .snippets-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .snippet-card {
                padding: 0.75rem;
                overflow: hidden;
            }
            
            .snippet-content {
                -webkit-line-clamp: 4;
                font-size: 0.9375rem;
                line-height: 1.5;
            }
            
            .snippet-title {
                flex-wrap: wrap;
                font-size: 1rem;
                line-height: 1.4;
            }
            
            .snippet-actions {
                opacity: 1;
                position: static;
                margin-top: 0.5rem;
                display: flex;
                justify-content: flex-end;
            }
            
            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
            
            .btn {
                padding: 1rem 1.25rem;
                font-size: 1rem;
                min-height: 48px;
            }
            
            .mobile-category-badge {
                display: inline-flex;
                align-items: center;
                gap: 0.25rem;
                padding: 0.375rem 0.625rem;
                background-color: #f0f0f0;
                border-radius: 0.25rem;
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }
            
            .mobile-only {
                display: block !important;
            }
            
            .desktop-only {
                display: none !important;
            }
        }
        
        /* Hide mobile elements on desktop */
        .mobile-menu-btn {
            display: none;
        }
        
        .mobile-menu-header {
            display: none;
        }
        
        .mobile-only {
            display: none;
        }
        
        /* Disable animations on mobile for performance */
        @media (max-width: 768px) {
            .snippet-card {
                animation: none !important;
            }
            
            .category-item {
                transition: none !important;
            }
            
            .btn {
                transition: none !important;
            }
        }
        
        /* Touch-friendly sizes */
        @media (max-width: 768px) {
            .btn-icon {
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .category-item {
                padding: 1rem;
            }
            
            .form-input, .form-textarea, .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 0.75rem;
            }
            
            input[type="search"] {
                -webkit-appearance: none;
                appearance: none;
            }
            
            /* ãƒ¢ãƒã‚¤ãƒ«ã§æ¤œç´¢ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç¸¦ã«é…ç½® */
            @media (max-width: 480px) {
                main > div:first-child {
                    flex-direction: column;
                    gap: 0.75rem;
                }
                
                main input[type="search"] {
                    max-width: 100% !important;
                    width: 100%;
                }
                
                /* é•·ã„æ–‡ç« å¯¾ç­– */
                .snippet-card {
                    min-width: 0;
                    width: 100%;
                }
                
                .snippet-content {
                    font-size: 0.875rem;
                    line-height: 1.6;
                }
                
                /* ãƒ¢ãƒ¼ãƒ€ãƒ«èª¿æ•´ */
                .modal-content {
                    padding: 1rem;
                    margin: 0.5rem;
                    width: calc(100% - 1rem);
                }
                
                /* ãƒ˜ãƒƒãƒ€ãƒ¼èª¿æ•´ */
                .header {
                    padding: 0.75rem;
                }
                
                .logo {
                    font-size: 1.25rem;
                }
                
                /* ãƒœã‚¿ãƒ³èª¿æ•´ */
                .user-info .btn {
                    padding: 0.75rem 1rem;
                    font-size: 0.875rem;
                    min-height: 44px;
                }
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="snippetModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header" id="modalTitle">æ–°è¦å®šå‹æ–‡</h2>
            <form id="snippetForm">
                <div class="form-group">
                    <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="snippetTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                    <select id="snippetCategory" class="form-select" required>
                        <!-- Categories will be populated here -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">å†…å®¹</label>
                    <textarea id="snippetContent" class="form-textarea" required></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Edit Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header">ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’ç·¨é›†</h2>
            <form id="categoryForm">
                <div class="form-group">
                    <label class="form-label">ã‚«ãƒ†ã‚´ãƒªãƒ¼å</label>
                    <input type="text" id="categoryName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ã‚¢ã‚¤ã‚³ãƒ³</label>
                    <input type="text" id="categoryIcon" class="form-input" placeholder="çµµæ–‡å­—ã‚’å…¥åŠ›" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ã‚«ãƒ©ãƒ¼</label>
                    <input type="color" id="categoryColor" class="form-input" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="deleteCategory()">å‰Šé™¤</button>
                    <button type="button" class="btn" onclick="closeCategoryModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDjrzvuPGmNrQuqzBnN_y5xDStCU-y5HlM",
            authDomain: "quickclip-4446c.firebaseapp.com",
            projectId: "quickclip-4446c",
            storageBucket: "quickclip-4446c.firebasestorage.app",
            messagingSenderId: "31602504581",
            appId: "1:31602504581:web:c80fe6bf2a0e60c281caec",
            measurementId: "G-H0GXNRP5TW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const provider = new firebase.auth.GoogleAuthProvider();

        // Global state
        let currentUser = null;
        let categories = [];
        let snippets = [];
        let selectedCategory = null;
        let editingSnippet = null;
        let editingCategory = null;
        let searchQuery = '';

        // Default categories
        const defaultCategories = [
            { name: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', icon: 'ğŸ”‘', color: '#ef4444', order: 0 },
            { name: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ', icon: 'ğŸ’»', color: '#a855f7', order: 1 },
            { name: 'åŒ»ç™‚å®šå‹æ–‡', icon: 'â¤ï¸', color: '#3b82f6', order: 2 },
            { name: 'ãƒ¡ãƒ¼ãƒ«ç½²å', icon: 'âœ‰ï¸', color: '#10b981', order: 3 },
            { name: 'ã‚¹ã‚¿ãƒƒãƒ•é€£çµ¡', icon: 'ğŸ‘¥', color: '#f97316', order: 4 }
        ];

        // Keyboard shortcuts will be initialized after functions are defined
        function initKeyboardShortcuts() {
            if (window.innerWidth > 768) {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + K ã§æ¤œç´¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        const searchInput = document.querySelector('input[type="search"]');
                        if (searchInput) searchInput.focus();
                    }
                    // Ctrl/Cmd + N ã§æ–°è¦è¿½åŠ 
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        if (currentUser) openModal();
                    }
                    // Esc ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                    if (e.key === 'Escape') {
                        closeModal();
                        closeCategoryModal();
                    }
                });
            }
        }

        // Auth state listener
        auth.onAuthStateChanged(async (user) => {
            currentUser = user;
            if (user) {
                await initializeUserData(user.uid);
                renderApp();
            } else {
                renderLoginScreen();
            }
        });

        // Initialize user data
        async function initializeUserData(userId) {
            try {
                // Check if user has categories
                const categoriesSnapshot = await db.collection('users').doc(userId).collection('categories').get();
                
                if (categoriesSnapshot.empty) {
                    // Create default categories for new user
                    for (const category of defaultCategories) {
                        await db.collection('users').doc(userId).collection('categories').add({
                            ...category,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }
                
                // Load user data
                await loadUserData(userId);
                
                // Check for local storage migration
                const hasLocalData = localStorage.getItem('quickclip_categories') || localStorage.getItem('quickclip_snippets');
                if (hasLocalData) {
                    if (confirm('ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã«ç§»è¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
                        await migrateFromLocalStorage(userId);
                    }
                }
            } catch (error) {
                console.error('Error initializing user data:', error);
            }
        }

        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                // Load categories
                const categoriesSnapshot = await db.collection('users').doc(userId).collection('categories')
                    .orderBy('order', 'asc').get();
                categories = categoriesSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Load snippets
                const snippetsSnapshot = await db.collection('users').doc(userId).collection('snippets')
                    .orderBy('createdAt', 'desc').get();
                snippets = snippetsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Migrate from local storage
        async function migrateFromLocalStorage(userId) {
            try {
                const localCategories = JSON.parse(localStorage.getItem('quickclip_categories') || '[]');
                const localSnippets = JSON.parse(localStorage.getItem('quickclip_snippets') || '[]');
                
                // Create a mapping of old category IDs to new ones
                const categoryIdMap = {};
                
                // Migrate categories
                for (const category of localCategories) {
                    const docRef = await db.collection('users').doc(userId).collection('categories').add({
                        name: category.name,
                        icon: category.icon || 'ğŸ“',
                        color: category.color || '#3b82f6',
                        order: category.order || 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    categoryIdMap[category.id] = docRef.id;
                }
                
                // Migrate snippets
                for (const snippet of localSnippets) {
                    await db.collection('users').doc(userId).collection('snippets').add({
                        title: snippet.title,
                        content: snippet.content,
                        categoryId: categoryIdMap[snippet.categoryId] || categories[0]?.id,
                        isPinned: snippet.pinned || false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Clear local storage
                localStorage.removeItem('quickclip_categories');
                localStorage.removeItem('quickclip_snippets');
                
                // Reload data
                await loadUserData(userId);
                showSuccess('ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«ç§»è¡Œã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Migration error:', error);
                alert('ãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        // Render functions
        function renderLoginScreen() {
            document.getElementById('app').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
                    <div style="background-color: #fff; padding: 2rem; border-radius: 0.5rem; text-align: center; max-width: 400px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);">
                        <h1 style="font-size: 2rem; margin-bottom: 1rem; color: #333;">QuickClip</h1>
                        <p style="color: #666; margin-bottom: 2rem;">å®šå‹æ–‡ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã§ç®¡ç†</p>
                        <button onclick="signIn()" class="btn btn-primary" style="width: 100%;">
                            Googleã§ãƒ­ã‚°ã‚¤ãƒ³
                        </button>
                    </div>
                </div>
            `;
        }

        function renderApp() {
            let filteredSnippets = selectedCategory 
                ? snippets.filter(s => s.categoryId === selectedCategory)
                : snippets;
            
            // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            if (searchQuery) {
                filteredSnippets = filteredSnippets.filter(s => 
                    s.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    s.content.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }
            
            // Sort snippets: pinned first
            filteredSnippets.sort((a, b) => {
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;
                return 0;
            });

            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <header class="header">
                    <div class="header-content">
                        <h1 class="logo">QuickClip</h1>
                        <div class="user-info">
                            <button onclick="exportData()" class="btn" title="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ">ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                            <label class="btn" style="cursor: pointer;" title="ã‚¤ãƒ³ãƒãƒ¼ãƒˆ">
                                ğŸ“¤ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                                <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                            </label>
                            <span>${currentUser.email}</span>
                            <button onclick="signOut()" class="btn btn-danger">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </div>
                    </div>
                </header>

                <!-- Main Container -->
                <div class="container">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <button onclick="openModal()" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem; position: relative;">
                            ï¼‹ æ–°è¦è¿½åŠ 
                            <kbd class="desktop-only" style="position: absolute; right: 0.75rem; font-size: 0.75rem; padding: 0.125rem 0.375rem; background: rgba(255,255,255,0.2); border-radius: 0.25rem;">âŒ˜N</kbd>
                        </button>
                        
                        <div class="mobile-menu-header">
                            <h2 style="font-size: 1.25rem; font-weight: 600;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                            <button onclick="closeMobileMenu()" class="btn-icon" style="font-size: 1.5rem;">Ã—</button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h2 style="font-size: 1.125rem; font-weight: 600;">ã‚«ãƒ†ã‚´ãƒªãƒ¼</h2>
                            <button onclick="openCategoryModal()" class="btn-icon" title="ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ ">
                                ï¼‹
                            </button>
                        </div>
                        <ul class="category-list">
                            <li class="category-item ${!selectedCategory ? 'active' : ''}" onclick="selectCategory(null)">
                                <span class="category-icon" style="background-color: #4b5563;">ğŸ“‹</span>
                                <span>ã™ã¹ã¦ (${snippets.length})</span>
                            </li>
                            ${categories.map(category => `
                                <li class="category-item ${selectedCategory === category.id ? 'active' : ''}" 
                                    onclick="selectCategory('${category.id}')">
                                    <span class="category-icon" style="background-color: ${category.color};">
                                        ${category.icon}
                                    </span>
                                    <span style="flex: 1;">${category.name} (${snippets.filter(s => s.categoryId === category.id).length})</span>
                                    <button class="btn-icon category-edit-btn" onclick="event.stopPropagation(); editCategory('${category.id}')" title="ç·¨é›†">
                                        âœï¸
                                    </button>
                                </li>
                            `).join('')}
                        </ul>
                    </aside>

                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                        â˜°
                    </button>
                    
                    <!-- Mobile Add Button -->
                    <button class="mobile-menu-btn mobile-add-btn" onclick="openModal()" style="bottom: 5rem; background-color: #10b981;">
                        ï¼‹
                    </button>

                    <!-- Main Content -->
                    <main class="main-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h2 style="font-size: 1.5rem; font-weight: 600; margin: 0;">
                                <span class="desktop-only">${selectedCategory ? categories.find(c => c.id === selectedCategory)?.name || 'ã™ã¹ã¦' : 'ã™ã¹ã¦ã®å®šå‹æ–‡'}</span>
                                <button onclick="toggleMobileMenu()" class="btn btn-primary mobile-only">
                                    ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ
                                </button>
                            </h2>
                            <div style="position: relative; max-width: 300px;">
                                <input type="search" 
                                       placeholder="æ¤œç´¢... (Enterã§å®Ÿè¡Œ)" 
                                       class="form-input" 
                                       style="width: 100%; padding-left: 2.5rem; padding-right: 3rem;"
                                       value="${searchQuery}"
                                       onkeydown="handleSearchKeydown(event)">
                                <span style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: #9ca3af;">ğŸ”</span>
                            </div>
                        </div>
                        
                        ${filteredSnippets.length === 0 ? `
                            <div class="empty-state">
                                <p style="font-size: 1.125rem; margin-bottom: 1rem;">å®šå‹æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</p>
                                <button onclick="openModal()" class="btn btn-primary">æ–°ã—ã„å®šå‹æ–‡ã‚’è¿½åŠ </button>
                            </div>
                        ` : `
                            <div class="snippets-grid">
                                ${filteredSnippets.map(snippet => {
                                    const category = categories.find(c => c.id === snippet.categoryId);
                                    return `
                                        <div class="snippet-card" onclick="handleSnippetClick(event, '${snippet.id}')">
                                            <div class="mobile-category-badge mobile-only">
                                                ${category ? `<span style="color: ${category.color};">${category.icon}</span>` : ''}
                                                <span>${category?.name || 'ã‚«ãƒ†ã‚´ãƒªãƒ¼ãªã—'}</span>
                                            </div>
                                            <div class="snippet-title">
                                                <span class="desktop-only">${category ? `<span style="color: ${category.color};">${category.icon}</span>` : ''}</span>
                                                <span>${snippet.title}</span>
                                                ${snippet.isPinned ? '<span class="pin-icon">â­</span>' : ''}
                                            </div>
                                            <div class="snippet-content">${snippet.content}</div>
                                            <div class="snippet-actions">
                                                <button class="btn-icon" onclick="togglePin('${snippet.id}')" title="ãƒ”ãƒ³ç•™ã‚">
                                                    ${snippet.isPinned ? 'â­' : 'â˜†'}
                                                </button>
                                                <button class="btn-icon copy-btn" onclick="copyToClipboard('${snippet.content.replace(/'/g, "\\'")}')" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼">
                                                    ğŸ“‹
                                                </button>
                                                <button class="btn-icon" onclick="editSnippet('${snippet.id}')" title="ç·¨é›†">
                                                    âœï¸
                                                </button>
                                                <button class="btn-icon" onclick="deleteSnippet('${snippet.id}')" title="å‰Šé™¤">
                                                    ğŸ—‘ï¸
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </main>
                </div>
            `;
        }

        // UI Functions
        function selectCategory(categoryId) {
            selectedCategory = categoryId;
            renderApp();
            // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
            if (window.innerWidth <= 768) {
                closeMobileMenu();
            }
        }
        
        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.classList.toggle('mobile-active');
            }
        }
        
        function closeMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.classList.remove('mobile-active');
            }
        }
        
        function handleSnippetClick(event, snippetId) {
            // ãƒ¢ãƒã‚¤ãƒ«ã§ã‚«ãƒ¼ãƒ‰å…¨ä½“ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã«ã‚³ãƒ”ãƒ¼
            if (window.innerWidth <= 768 && !event.target.closest('.btn-icon')) {
                const snippet = snippets.find(s => s.id === snippetId);
                if (snippet) {
                    copyToClipboard(snippet.content);
                }
            }
        }
        
        function handleSearchKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                searchQuery = event.target.value;
                console.log('Search query:', searchQuery); // Debug log
                renderApp();
                // Keep focus on search input after render
                setTimeout(() => {
                    const searchInput = document.querySelector('input[type="search"]');
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
                    }
                }, 0);
            } else if (event.key === 'Escape') {
                event.preventDefault();
                event.target.value = '';
                searchQuery = '';
                renderApp();
                // Keep focus on search input after render
                setTimeout(() => {
                    const searchInput = document.querySelector('input[type="search"]');
                    if (searchInput) searchInput.focus();
                }, 0);
            }
        }

        function openModal(snippetId = null) {
            editingSnippet = snippetId ? snippets.find(s => s.id === snippetId) : null;
            
            document.getElementById('modalTitle').textContent = editingSnippet ? 'å®šå‹æ–‡ã‚’ç·¨é›†' : 'æ–°è¦å®šå‹æ–‡';
            document.getElementById('snippetTitle').value = editingSnippet?.title || '';
            document.getElementById('snippetContent').value = editingSnippet?.content || '';
            
            // Populate categories
            const categorySelect = document.getElementById('snippetCategory');
            categorySelect.innerHTML = categories.map(category => `
                <option value="${category.id}" ${editingSnippet?.categoryId === category.id ? 'selected' : ''}>
                    ${category.icon} ${category.name}
                </option>
            `).join('');
            
            if (!editingSnippet && selectedCategory) {
                categorySelect.value = selectedCategory;
            }
            
            document.getElementById('snippetModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('snippetModal').classList.remove('active');
            editingSnippet = null;
        }

        function editSnippet(snippetId) {
            openModal(snippetId);
        }

        async function deleteSnippet(snippetId) {
            if (!confirm('ã“ã®å®šå‹æ–‡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('snippets').doc(snippetId).delete();
                await loadUserData(currentUser.uid);
                renderApp();
                showSuccess('å®šå‹æ–‡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Error deleting snippet:', error);
                alert('å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }

        async function togglePin(snippetId) {
            const snippet = snippets.find(s => s.id === snippetId);
            if (!snippet) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('snippets').doc(snippetId).update({
                    isPinned: !snippet.isPinned
                });
                await loadUserData(currentUser.uid);
                renderApp();
            } catch (error) {
                console.error('Error toggling pin:', error);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(err => {
                console.error('Copy failed:', err);
                // Fallback method
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showSuccess('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        // Form submission
        document.getElementById('snippetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const title = document.getElementById('snippetTitle').value;
            const content = document.getElementById('snippetContent').value;
            const categoryId = document.getElementById('snippetCategory').value;
            
            try {
                if (editingSnippet) {
                    // Update existing snippet
                    await db.collection('users').doc(currentUser.uid).collection('snippets').doc(editingSnippet.id).update({
                        title,
                        content,
                        categoryId,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showSuccess('å®šå‹æ–‡ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                } else {
                    // Create new snippet
                    await db.collection('users').doc(currentUser.uid).collection('snippets').add({
                        title,
                        content,
                        categoryId,
                        isPinned: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showSuccess('å®šå‹æ–‡ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                }
                
                await loadUserData(currentUser.uid);
                closeModal();
                renderApp();
            } catch (error) {
                console.error('Error saving snippet:', error);
                alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        });

        // Export/Import functions
        async function exportData() {
            try {
                const exportData = {
                    version: '1.0',
                    exportedAt: new Date().toISOString(),
                    categories: categories,
                    snippets: snippets
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `quickclip-export-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showSuccess('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Export error:', error);
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                if (!data.categories || !data.snippets) {
                    throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                }
                
                const confirmMsg = `${data.categories.length}å€‹ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¨${data.snippets.length}å€‹ã®å®šå‹æ–‡ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚\næ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`;
                if (!confirm(confirmMsg)) return;
                
                // Import categories
                const categoryIdMap = {};
                for (const category of data.categories) {
                    const oldId = category.id;
                    const docRef = await db.collection('users').doc(currentUser.uid).collection('categories').add({
                        name: category.name,
                        icon: category.icon || 'ğŸ“',
                        color: category.color || '#3b82f6',
                        order: category.order || categories.length,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    categoryIdMap[oldId] = docRef.id;
                }
                
                // Import snippets
                for (const snippet of data.snippets) {
                    const categoryId = categoryIdMap[snippet.categoryId] || snippet.categoryId || categories[0]?.id;
                    await db.collection('users').doc(currentUser.uid).collection('snippets').add({
                        title: snippet.title,
                        content: snippet.content,
                        categoryId: categoryId,
                        isPinned: snippet.isPinned || snippet.pinned || false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                // Reload data
                await loadUserData(currentUser.uid);
                renderApp();
                showSuccess('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                
                // Reset file input
                event.target.value = '';
            } catch (error) {
                console.error('Import error:', error);
                alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // Category functions
        function openCategoryModal() {
            editingCategory = null;
            document.getElementById('categoryName').value = '';
            document.getElementById('categoryIcon').value = '';
            document.getElementById('categoryColor').value = '#3b82f6';
            document.getElementById('categoryModal').classList.add('active');
        }
        
        function editCategory(categoryId) {
            editingCategory = categories.find(c => c.id === categoryId);
            if (!editingCategory) return;
            
            document.getElementById('categoryName').value = editingCategory.name;
            document.getElementById('categoryIcon').value = editingCategory.icon;
            document.getElementById('categoryColor').value = editingCategory.color;
            document.getElementById('categoryModal').classList.add('active');
        }
        
        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
            editingCategory = null;
        }
        
        async function deleteCategory() {
            if (!editingCategory) return;
            
            // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«å±ã™ã‚‹å®šå‹æ–‡ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const categorySnippets = snippets.filter(s => s.categoryId === editingCategory.id);
            if (categorySnippets.length > 0) {
                alert(`ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«ã¯${categorySnippets.length}å€‹ã®å®šå‹æ–‡ãŒã‚ã‚Šã¾ã™ã€‚å…ˆã«å®šå‹æ–‡ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€ä»–ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚`);
                return;
            }
            
            if (!confirm('ã“ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).collection('categories').doc(editingCategory.id).delete();
                await loadUserData(currentUser.uid);
                closeCategoryModal();
                renderApp();
                showSuccess('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
        
        // Category form submission
        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('categoryName').value;
            const icon = document.getElementById('categoryIcon').value;
            const color = document.getElementById('categoryColor').value;
            
            try {
                if (editingCategory) {
                    // Update existing category
                    await db.collection('users').doc(currentUser.uid).collection('categories').doc(editingCategory.id).update({
                        name,
                        icon,
                        color,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showSuccess('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                } else {
                    // Create new category
                    await db.collection('users').doc(currentUser.uid).collection('categories').add({
                        name,
                        icon,
                        color,
                        order: categories.length,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showSuccess('ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                }
                
                await loadUserData(currentUser.uid);
                closeCategoryModal();
                renderApp();
            } catch (error) {
                console.error('Error saving category:', error);
                alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        });

        // Auth functions
        function signIn() {
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('Login successful:', result.user.email);
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                });
        }

        function signOut() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                auth.signOut()
                    .then(() => {
                        console.log('Signed out successfully');
                    })
                    .catch((error) => {
                        console.error('Sign out error:', error);
                    });
            }
        }
        
        // Initialize keyboard shortcuts after all functions are defined
        initKeyboardShortcuts();
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«é–¢æ•°ã‚’å…¬é–‹ï¼ˆHTMLå†…ã®onclickã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ï¼‰
        window.signIn = signIn;
        window.signOut = signOut;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.openCategoryModal = openCategoryModal;
        window.closeCategoryModal = closeCategoryModal;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.selectCategory = selectCategory;
        window.toggleMobileMenu = toggleMobileMenu;
        window.closeMobileMenu = closeMobileMenu;
        window.handleSnippetClick = handleSnippetClick;
        window.searchSnippets = searchSnippets;
        window.handleSearchKeydown = handleSearchKeydown;
        window.togglePin = togglePin;
        window.copyToClipboard = copyToClipboard;
        window.editSnippet = editSnippet;
        window.deleteSnippet = deleteSnippet;
        window.exportData = exportData;
        window.importData = importData;
        
        }); // DOMContentLoaded
    </script>
</body>
</html>